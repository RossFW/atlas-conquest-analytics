# Data Model

> Defines the JSON data contracts between the pipeline (`scripts/`) and the frontend (`site/`).

## Data Files

All files live in `site/data/` and are generated by `scripts/fetch_data.py`.

| File | Description | Time-filtered |
|------|-------------|:---:|
| `metadata.json` | Match counts, player counts, timestamps | Yes |
| `commander_stats.json` | Per-commander winrate, matches, wins | Yes |
| `matchups.json` | Commander-vs-commander winrate matrix | Yes |
| `card_stats.json` | Per-card play/draw/deck rates and winrates | Yes |
| `trends.json` | Weekly faction popularity percentages | Yes |
| `game_distributions.json` | Duration, turns, actions histograms | Yes |
| `deck_composition.json` | Per-commander deck cost, type ratios, loyalty | Yes |
| `cards.json` | Card definitions from CSV (reference data) | No |
| `commanders.json` | Commander definitions from CSV (reference data) | No |

## Time Period Nesting

Stats files are nested by time period. The frontend reads `data[period]` where period is one of: `all`, `6m`, `3m`, `1m`.

```json
{
  "all": <full data>,
  "6m": <last 180 days>,
  "3m": <last 90 days>,
  "1m": <last 30 days>
}
```

Reference files (`cards.json`, `commanders.json`) are flat arrays — no period nesting.

## Schema Definitions

### metadata.json
```json
{
  "all": {
    "last_updated": "2026-02-22T06:00:00Z",
    "total_matches": 3104,
    "total_players": 202,
    "data_version": "2.0.0"
  },
  "6m": { ... },
  "3m": { ... },
  "1m": { ... }
}
```

### commander_stats.json
```json
{
  "all": [
    {
      "name": "Jagris, the Huntsman",
      "faction": "grenalia",
      "matches": 983,
      "wins": 590,
      "winrate": 0.6002
    }
  ],
  "6m": [ ... ],
  "3m": [ ... ],
  "1m": [ ... ]
}
```

### matchups.json
```json
{
  "all": {
    "commanders": ["Captain Greenbeard", "Elber, Jungle Emissary", ...],
    "matchups": [
      {
        "commander": "Captain Greenbeard",
        "opponent": "Elber, Jungle Emissary",
        "wins": 45,
        "losses": 38,
        "total": 83,
        "winrate": 0.5422
      }
    ]
  },
  "6m": { ... },
  "3m": { ... },
  "1m": { ... }
}
```

### card_stats.json
```json
{
  "all": [
    {
      "name": "Fireball",
      "faction": "neutral",
      "type": "Spell",
      "deck_count": 1200,
      "deck_rate": 0.1932,
      "deck_winrate": 0.5100,
      "drawn_count": 800,
      "drawn_rate": 0.1288,
      "drawn_winrate": 0.5250,
      "played_count": 600,
      "played_rate": 0.0966,
      "played_winrate": 0.5400
    }
  ],
  "6m": [ ... ],
  "3m": [ ... ],
  "1m": [ ... ]
}
```

### trends.json
```json
{
  "all": {
    "dates": ["2025-W40", "2025-W41", ...],
    "factions": {
      "skaal": [22.5, 23.1, ...],
      "grenalia": [18.0, 17.5, ...],
      "lucia": [20.0, 21.0, ...],
      "neutral": [15.0, 14.5, ...],
      "shadis": [12.0, 12.5, ...],
      "archaeon": [12.5, 11.4, ...]
    }
  },
  "6m": { ... },
  "3m": { ... },
  "1m": { ... }
}
```

### game_distributions.json
```json
{
  "all": {
    "duration": {
      "labels": ["0-2", "2-4", "4-6", ...],
      "counts": [44, 157, 318, ...],
      "total": 3104
    },
    "turns": {
      "labels": ["0-2", "2-4", "4-6", ...],
      "counts": [12, 85, 220, ...],
      "total": 3104
    },
    "actions": {
      "labels": ["0-20", "20-40", "40-60", ...],
      "counts": [95, 310, 480, ...],
      "total": 3104
    }
  },
  "6m": { ... },
  "3m": { ... },
  "1m": { ... }
}
```

### deck_composition.json
```json
{
  "all": {
    "Jagris, the Huntsman": {
      "faction": "grenalia",
      "deck_count": 983,
      "avg_cost": 3.42,
      "cost_histogram": {
        "labels": ["0", "1", "2", ..., "12+"],
        "all_decks": [0.5, 2.1, 8.3, ...],
        "winning_decks": [0.5, 2.0, 8.1, ...],
        "losing_decks": [0.5, 2.2, 8.5, ...]
      },
      "avg_minion_count": 28.5,
      "avg_spell_count": 12.3,
      "avg_patron_cards": 18.2,
      "avg_neutral_cards": 20.8,
      "avg_other_cards": 1.8,
      "win_avg_minion_count": 28.8,
      "win_avg_spell_count": 12.1,
      "loss_avg_minion_count": 28.2,
      "loss_avg_spell_count": 12.5
    }
  },
  "6m": { ... },
  "3m": { ... },
  "1m": { ... }
}
```

### cards.json (flat — no period nesting)
```json
[
  {
    "name": "Fireball",
    "type": "Spell",
    "text": "Deal 3 damage to a character.",
    "subtype": "",
    "cost": 3,
    "attack": null,
    "speed": null,
    "health": null,
    "legendary": false,
    "faction": "neutral",
    "art": "CardScreenshots/Fireball.png"
  }
]
```

### commanders.json (flat — no period nesting)
```json
[
  {
    "name": "Jagris, the Huntsman",
    "text": "[Range 2, Cooldown 2]: A minion gains +1/+1/+1.",
    "subtype": "Human",
    "dominion": 5,
    "intellect": 6,
    "speed": 1,
    "health": 30,
    "faction": "grenalia",
    "art": "assets/commanders/jagris-the-huntsman.jpg"
  }
]
```

## Factions

Six factions with colorblind-safe Okabe-Ito colors:

| Faction | Key | Color |
|---------|-----|-------|
| Skaal | `skaal` | `#D55E00` |
| Grenalia | `grenalia` | `#009E73` |
| Lucia | `lucia` | `#E8B630` |
| Neutral | `neutral` | `#A89078` |
| Shadis | `shadis` | `#7B7B8E` |
| Archaeon | `archaeon` | `#0072B2` |
