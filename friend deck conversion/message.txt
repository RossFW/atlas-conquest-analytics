public static string CreateDeckCode(Deck deck) {
            FullCardList cardList = FullCardList.GetFullCardList();
    
            // Commander, Deck Name
            char commander = (char) cardList.GetCardIdFromName(deck.CommanderName);
            string b64PrefixAndName = Util.Base64Encode($"{commander}{deck.Name}");
    
            // Cards and Counts
            List<CardCount> rawCards = deck.RawCards;
    
            int currentPosition = 0;
            BitArray bitsArray = new BitArray(20 * rawCards.Count);
    
            foreach (CardCount cardCount in rawCards) {
                // 14 bits for card id
                int id = cardList.GetCardIdFromName(cardCount.CardName);
                StackBits(ref bitsArray, ref currentPosition, id, 14);
    
                // 6 bits for card count
                int count = cardCount.Count;
                StackBits(ref bitsArray, ref currentPosition, count, 6);
                Debug.Log("CardCount stacked " + cardCount.CardName);
            }
    
            int numBytes = bitsArray.Length / 8 + 1;
    
            byte[] cardBytes = new byte[numBytes];
            bitsArray.CopyTo(cardBytes, 0);
    
            string b64Cards = Convert.ToBase64String(cardBytes);
    
            return b64PrefixAndName + ":" + b64Cards;
        }
    
        // Assumes all bits come from the right end of the int
        private static void StackBits(ref BitArray bitsArray, ref int currentPosition, int bits, int length) {
            BitArray source = new BitArray(new int[1] { bits });
    
            for (int i = 0; i < length; i++)
            {
                bitsArray[currentPosition + i] = source[i];
            }
            
            currentPosition += length;
        }
    
        public static Deck ParseDeckCode(string code) {
            FullCardList cardList = FullCardList.GetFullCardList();
    
            Deck deck = Deck.CreateNewDeck();
            string[] splits = code.Split(":");
    
            // Commander, Deck Name
            string b64PrefixAndName = splits[0];
            string prefixAndName = Util.Base64Decode(b64PrefixAndName);
            int commanderId = (int) prefixAndName[0];
            Debug.Log("Parsing commander id " + commanderId);
            string commanderName = cardList.GetCardNameFromId(commanderId);
    
            string deckName = prefixAndName.Substring(1);
            
            Debug.Log($"Parsed commanderName={commanderName} deckName={deckName}");
    
            // Cards and Counts
            string b64Cards = splits[1];
            byte[] cardBytes = Convert.FromBase64String(b64Cards);
            BitArray bitsArray = new BitArray(cardBytes);
    
            List<CardCount> cardCounts = new List<CardCount>();
    
            for (int currentPosition = 0; currentPosition + 20 < bitsArray.Length; currentPosition += 20) {
                BitArray idArray = new BitArray(32);
                for (int i = 0; i < 14; i++) {
                    idArray[i] = bitsArray[currentPosition + i];
                }
                BitArray countArray = new BitArray(32);
                for (int i = 0; i < 6; i++) {
                    countArray[i] = bitsArray[currentPosition + i + 14];
                }
                int[] id = new int[1];
                int[] count = new int[1];
                idArray.CopyTo(id, 0);
                countArray.CopyTo(count, 0);
                try {
                    string cardName = cardList.GetCardNameFromId(id[0]);
                    if (count[0] > 0) {
                        cardCounts.Add(new CardCount {
                            CardName = cardName,
                            Count = count[0]
                        });
                    }
                } catch (Exception e) {
                    Debug.Log($"Failure to parse id={id[0]} count={count[0]}");
                    Debug.LogError(e);
                }
    
            }
    
            Debug.Log("Loaded deck " + deck.Name);
    
            deck.Name = deckName;
            deck.CommanderName = commanderName;
            deck.RawCards = cardCounts;
    
            return deck.CorrectLegacyMappings();;
        }